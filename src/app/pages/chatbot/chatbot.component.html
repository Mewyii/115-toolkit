<div class="control-bar">
  <button mat-raised-button color="primary" (click)="xlsFileIPicker.click()">
    <span class="text-with-loading-indicator"
      >Chatbot-Protokoll Ã¶ffnen
      <mat-progress-spinner
        *ngIf="verfugbarkeitsInfosAreLoading"
        diameter="20"
        mode="indeterminate"
        color="accent"
      ></mat-progress-spinner>
    </span>
  </button>
  <input
    #xlsFileIPicker
    [hidden]="true"
    [type]="'file'"
    [accept]="'.csv'"
    (change)="onStammdatenExcelFileSelected($event)"
  />
</div>

<div class="control-bar">
  <div>Gesamtanzahl Sessions: {{ chatbotSessions.length }}</div>
  <div>
    Sessions mit Nutzereingaben: {{ chatbotSessions.length - emptySessions }}
  </div>
  <div>Anzahl positives Nutzerfeedback: {{ positiveUserFeedbackCount }}</div>
  <div>Anzahl negatives Nutzerfeedback: {{ negativeUserFeedbackCount }}</div>
</div>
<mat-tab-group>
  <mat-tab label="Aufbereitete Daten">
    <div class="tab-content">
      <div class="type-results-container">
        <div style="width: 1000px">
          <ng-container *ngFor="let sessionInfo of chatbotSessions">
            <ng-container *ngIf="!sessionInfo.isEmptySession">
              <div class="session">
                {{ sessionInfo.sessionId }} ({{
                  sessionInfo.date | date : "mediumDate"
                }})
              </div>
              <ng-container *ngFor="let item of sessionInfo.infos">
                <div class="infos">
                  <div [style.width]="'100px'">
                    {{ item.date | date : "h:mm:ss" }}
                  </div>
                  <div [style.width]="'600px'">{{ item.userInput }}</div>
                </div>
                <div
                  class="bot-answer"
                  *ngIf="item.botAnswer"
                  [style.maxHeight]="botAnswerMaxHeight + 'rem'"
                >
                  <div *ngIf="item.botAnswer.metadata">
                    {{ item.botAnswer.metadata.mappedUserInput }}
                  </div>
                  <div [innerHTML]="item.botAnswer.content"></div>
                </div>
                <div *ngIf="item.userFeedback">
                  <mat-icon *ngIf="item.userFeedback === 'good'"
                    >thumb_up</mat-icon
                  >
                  <mat-icon *ngIf="item.userFeedback === 'bad'"
                    >thumb_down</mat-icon
                  >
                </div>
                <div class="feedback" *ngIf="item.userFeedbackText">
                  {{ item.userFeedbackText }}
                </div>
              </ng-container>
            </ng-container>
          </ng-container>
        </div>
      </div>
    </div>
  </mat-tab>
</mat-tab-group>
